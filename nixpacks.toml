[phases.setup]
# 强制 Node 23 以适配最新的集成环境
nixPkgs = ["nodejs_23"]

[phases.install]
# 直接安装依赖，edgeone 已在 package.json 的 devDependencies 中
cmds = ["npm ci"]

[phases.build]
# 1. 编译项目
# 2. 拷贝 package.json（EdgeOne 规范）
# 3. 增量部署：去掉了 --force，CLI 会自动进行文件哈希比对
cmds = [
    "npm run build",
    "cp package.json ./dist/",
    "npx edgeone pages deploy ./dist -n $EDGEONE_PROJECT_NAME -t $EDGEONE_API_TOKEN"
]

[start]
# 启动轻量级监控面板
cmd = "node deploy-wrapper.cjs"