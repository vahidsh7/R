---
import type { Lang } from '@/utils/i18n';
import { t } from '@/utils/translations';
import FooterNav from '@/ui/FooterNav.astro';
import { Icon } from 'astro-icon/components';
import { getRelativeLocaleUrl } from 'astro:i18n';
import Github from '@/assets/github.svg';

interface Props {
  lang?: Lang;
  githubUrl?: string;
  rssUrl?: string;
}

const resolvedLang = ((Astro.currentLocale as Lang | undefined) ??
  (Astro.props.lang as Lang | undefined) ??
  'zh') as Lang;

const siteName = t(resolvedLang, 'site.name');

const twitterHandleRaw = t(resolvedLang, 'site.twitter.site') || '';
const twitterHandle = String(twitterHandleRaw).replace(/^@/, '');
const xUrl = twitterHandle ? `https://x.com/${twitterHandle}` : 'https://x.com';
const githubUrl: string =
  (Astro.props.githubUrl as string | undefined) ?? 'https://github.com/idimilabs';

const rssUrl: string =
  (Astro.props.rssUrl as string | undefined) ?? getRelativeLocaleUrl(resolvedLang, '/rss.xml');
---

<footer class="header-glass mb-6 w-full">
  <div class="mx-auto max-w-6xl px-4 py-10 sm:px-6">
    <div class="grid grid-cols-1 gap-8 md:grid-cols-3">
      <div class="flex flex-col md:col-span-1">
        <div>
          <a
            href={getRelativeLocaleUrl(resolvedLang, '/')}
            class="inline-flex items-center gap-2 text-xl font-semibold tracking-tight text-neutral-950 transition-opacity hover:opacity-80 dark:text-neutral-100"
          >
            <span class="text-xl text-neutral-950 dark:text-neutral-300">
              {siteName}
            </span>
          </a>
          <div class="mt-4 flex items-center gap-4 text-sm">
            <a
              href={xUrl}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center gap-1 rounded-md p-2 text-neutral-600 transition-all hover:bg-black/5 hover:text-neutral-950 dark:text-neutral-400 dark:hover:bg-white/10 dark:hover:text-white"
            >
              <span aria-hidden="true"><Icon name="lucide:x" class="h-5 w-5" /></span>
              <span class="sr-only">X</span>
            </a>
            <a
              href={githubUrl}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center gap-1 rounded-md p-2 text-neutral-600 transition-all hover:bg-black/5 hover:text-neutral-950 dark:text-neutral-400 dark:hover:bg-white/10 dark:hover:text-white"
            >
              <span aria-hidden="true"><Github class="h-5 w-5" /></span>
              <span class="sr-only">GitHub</span>
            </a>
            <a
              href={rssUrl}
              class="inline-flex items-center gap-1 rounded-md p-2 text-neutral-600 transition-all hover:bg-black/5 hover:text-neutral-950 dark:text-neutral-400 dark:hover:bg-white/10 dark:hover:text-white"
            >
              <span aria-hidden="true"><Icon name="lucide:rss" class="h-5 w-5" /></span>
              <span class="sr-only">RSS</span>
            </a>
          </div>
        </div>

        {/* Desktop/Tablet: Copyright below social icons - pushed to bottom */}
        <div
          class="mt-auto hidden flex-row items-baseline gap-2 text-[10px] text-neutral-500 md:flex dark:text-neutral-400"
        >
          <span>
            &copy; {new Date().getFullYear()}
            {siteName}
          </span>
        </div>
      </div>

      <FooterNav lang={resolvedLang} />
    </div>

    {/* Mobile only: Copyright at bottom center */}
    <div
      class="mt-10 flex flex-row items-center justify-center gap-2 text-[10px] text-neutral-500 md:hidden dark:text-neutral-400"
    >
      <span>
        &copy; {new Date().getFullYear()}
        {siteName}
      </span>
    </div>
  </div>
</footer>
