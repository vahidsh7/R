---
import OptimizedPicture from '@/features/OptimizedPicture.astro';
import SkeletonCardHorizontal from '@/ui/SkeletonCardHorizontal.astro';
import { formatDate } from '@/utils/date';
import type { Lang } from '@/utils/i18n';
import { categoryLabel } from '@/utils/translations';

interface Props {
  href?: string;
  imageSrc: any;
  imageAlt: string;
  title: string;
  description?: string;
  date?: string | Date;
  category?: string;
  author?: string;
  readingTime?: string;
  lang?: Lang;

  priority?: boolean;
  aspectClass?: string;
  class?: string;
  loading?: boolean;
}

const {
  href,
  imageSrc,
  imageAlt,
  title,
  description,
  date,
  category,
  author,
  readingTime,
  lang = 'zh',
  priority = false,
  aspectClass = 'aspect-[2.3/1]', // Ambilas featured article: ultra-wide ratio
  class: className,
  loading = false,
} = Astro.props as Props;

const Container = href ? 'a' : 'div';
const containerAttrs = href ? { href } : {};
---

{
  loading ? (
    <SkeletonCardHorizontal class={className} />
  ) : (
    <Container
      {...containerAttrs}
      class={`post-card-horizontal group relative block overflow-hidden rounded-[2rem] ${aspectClass} ${className ?? ''}`.trim()}
    >
      {/* Full image background - covers entire card */}
      <OptimizedPicture
        src={imageSrc}
        alt={imageAlt}
        class="absolute inset-0 h-full w-full object-cover object-center transition-transform duration-[800ms] ease-[cubic-bezier(0.4,0,0.2,1)] group-hover:scale-[1.02]"
        fit="cover"
        position="center"
        priority={priority}
        sizes="(max-width: 768px) 100vw, (max-width: 1200px) 80vw, 1100px"
      />

      {/* Floating glass content box - bottom-right positioning */}
      <div class="post-card-horizontal__content pointer-events-none absolute bottom-1.5 left-1.5 w-[calc(50%-0.75rem)] rounded-[1.75rem] border border-white/10 p-6 shadow-2xl backdrop-blur-[18px] sm:p-7 lg:p-8">
        {/* Category tag + date - justified */}
        <div class="mb-4 flex items-center justify-between">
          {category ? (
            <span class="rounded-full bg-white/25 px-3 py-1 text-[10px] font-semibold tracking-wide text-white uppercase">
              {categoryLabel(lang, category)}
            </span>
          ) : (
            <span />
          )}
          <span class="text-xs text-white/70">{date ? formatDate(date, lang) : ''}</span>
        </div>

        {/* Title */}
        <h3
          class="text-xl leading-tight font-bold text-white sm:text-2xl lg:text-[1.75rem]"
          style="display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;"
        >
          {title}
        </h3>

        {/* Description */}
        {description && (
          <p
            class="mt-3 text-sm leading-relaxed text-white/75"
            style="display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;"
          >
            {description}
          </p>
        )}
      </div>

      {href && (
        <span class="pointer-events-none absolute inset-0 rounded-[2rem] ring-transparent ring-inset focus-within:ring-2 focus-within:ring-white/50" />
      )}
    </Container>
  )
}
