---
import OptimizedPicture from '@/features/OptimizedPicture.astro';
import SkeletonCardCover from '@/ui/SkeletonCardCover.astro';
import { formatDate } from '@/utils/date';
import type { Lang } from '@/utils/i18n';
import { categoryLabel } from '@/utils/translations';

interface Props {
  href?: string;
  imageSrc: any;
  imageAlt: string;
  title: string;
  date?: string | Date;
  category?: string;
  lang?: Lang;

  priority?: boolean;
  aspectClass?: string;
  class?: string;
  loading?: boolean;
}

const {
  href,
  imageSrc,
  imageAlt,
  title,
  date,
  category,
  lang = 'zh',
  priority = false,
  aspectClass = 'aspect-[3/4]', // Vertical card: 3:4 ratio
  class: className,
  loading = false,
} = Astro.props as Props;

const Container = href ? 'a' : 'div';
const containerAttrs = href ? { href } : {};
---

{
  loading ? (
    <SkeletonCardCover aspectClass={aspectClass} class={className} />
  ) : (
    <Container
      {...containerAttrs}
      class={`post-card group relative flex flex-col overflow-hidden rounded-2xl ${aspectClass} ${className ?? ''}`.trim()}
    >
      {/* Image area - uses object-cover to crop and focus on center content */}
      <OptimizedPicture
        src={imageSrc}
        alt={imageAlt}
        class="absolute inset-0 h-full w-full object-cover object-center transition-transform duration-[800ms] ease-[cubic-bezier(0.4,0,0.2,1)] group-hover:scale-[1.03]"
        fit="cover"
        position="center"
        priority={priority}
        sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 400px"
      />

      {/* Glass-morphism content area - dynamically colored by DynamicGlass */}
      <div class="post-card__content pointer-events-none absolute right-1.5 bottom-1.5 left-1.5 flex flex-col justify-end rounded-xl border border-white/15 p-4 shadow-lg backdrop-blur-xl sm:p-5">
        {/* Category tag + date - justified */}
        <div class="mb-3 flex items-center justify-between">
          {category ? (
            <span class="rounded-full bg-white/25 px-3 py-1 text-[10px] font-semibold tracking-wide text-white uppercase">
              {categoryLabel(lang, category)}
            </span>
          ) : (
            <span />
          )}
          <span class="text-xs text-white/70">{date ? formatDate(date, lang) : ''}</span>
        </div>

        {/* Title */}
        <h3
          class="text-base leading-snug font-bold text-white sm:text-lg md:text-xl"
          style="display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;"
        >
          {title}
        </h3>
      </div>

      {href && (
        <span class="pointer-events-none absolute inset-0 rounded-2xl ring-transparent ring-inset focus-within:ring-2 focus-within:ring-white/50" />
      )}
    </Container>
  )
}
