---
import { getCollection } from 'astro:content';
import LandingLayout from '@/layouts/LandingLayout.astro';
import type { Lang } from '@/utils/i18n';
import { DEFAULT_LANG, SUPPORTED_LANGS } from '@/utils/i18n';
import { t } from '@/utils/translations';

export async function getStaticPaths() {
  return SUPPORTED_LANGS.map((lang) => ({ params: { lang } }));
}

const lang = ((Astro.params.lang as Lang) || DEFAULT_LANG) as Lang;

const all = await getCollection('post', (p) => !p.data.draft && p.data.locales === lang);

const CATEGORY_KEYS = ['build', 'invest', 'life'] as const;

function countFor(key: (typeof CATEGORY_KEYS)[number]) {
  const translated = String(t(lang as any, `categories.${key}`)).toLowerCase();
  return all.filter((p) => {
    const c = String(p.data.category || '').toLowerCase();
    return c === translated || c === key;
  }).length;
}

const items = CATEGORY_KEYS.map((key) => ({
  key,
  label: String(t(lang as any, `categories.${key}`)),
  href: `/${lang}/category/${key}/`,
  count: countFor(key),
}));

const pageTitle = t(lang, 'pages.categories.title');
const description = t(lang, 'pages.categories.description');
---

<LandingLayout
  lang={lang}
  title={pageTitle}
  description={description}
  canonical={Astro.url.href}
  centered={false}
>
  <section>
    <h2 class="mb-4 text-lg font-semibold">{t(lang, 'pages.categories.h2')}</h2>
    <div class="grid grid-cols-3 gap-4">
      {
        items.map((it) => (
          <a
            href={it.href}
            class="inline-flex w-full items-center gap-2 rounded-full border border-gray-200/70 px-3 py-1.5 text-sm text-gray-800 hover:bg-gray-50 dark:border-gray-800/70 dark:text-gray-200 dark:hover:bg-gray-800"
          >
            <span class="min-w-0 flex-1 truncate">{it.label}</span>
            <span class="shrink-0 rounded-full bg-gray-100 px-2 py-0.5 text-xs text-gray-600 dark:bg-gray-800 dark:text-gray-400">
              {it.count}
            </span>
          </a>
        ))
      }
    </div>
  </section>
</LandingLayout>
